!function(t,e){var i=e(jQuery),a="function"==typeof define&&define.amd;a?define(t,["jquery"],i):(this.jQuery||this.$||this)[t]=i}("jail",function(t){function e(t,e){var i=!1;!e||(i=e.data("triggerElem")),!!i&&"function"==typeof i.on&&(i.on(t.event+"."+t.id,{options:t,images:e},a),s.on("resize."+t.id,{options:t,images:e},a))}function i(e){var i=0;if(0!==e.length)for(;i!==e.length;)t(e[i]).attr("data-src")?i++:e.splice(i,1)}function a(a){var o=a.data.images,l=a.data.options;o.data("poller")||o.data("poller",setTimeout(function(){if(d=t.extend({},o),i(d),t(d).each(function(){this!==window&&r(l,this,d)}),n(d))return void t(a.currentTarget).unbind(a.type+"."+l.id);if("scroll"!==l.event){var c=/scroll/i.test(l.event)?o.data("triggerElem"):s;l.event="scroll",o.data("triggerElem",c),e(l,t(d))}o.data("poller",null)},l.timeout))}function n(e){var i=!0;return t(e).each(function(){!t(this).attr("data-src")||(i=!1)}),i}function r(e,i,a){var n=t(i),r=/scroll/i.test(e.event)?a.data("triggerElem"):s,f=!0;e.loadHiddenImages||(f=c(n,r,e)&&n.is(":visible")),f&&o(r,n,e.offset)&&l(e,n)}function o(t,e,i){var a=t[0]===window,n=a?{top:0,left:0}:t.offset(),r=n.top+(a?t.scrollTop():0),o=n.left+(a?t.scrollLeft():0),l=o+t.width(),c=r+t.height(),s=e.offset(),f=e.width(),d=e.height();return r-i<=s.top+d&&c+i>=s.top&&o-i<=s.left+f&&l+i>=s.left}function l(e,a){var r=new Image;r.onload=function(){a.hide().attr("src",r.src),a.removeAttr("data-src"),e.effect?(e.speed?a[e.effect](e.speed):a[e.effect](),a.css("opacity",1),a.show()):a.show(),i(d),!e.callbackAfterEachImage||e.callbackAfterEachImage.call(this,a,e),n(d)&&!!e.callback&&!u&&(e.callback.call(t.jail,e),u=!0)},r.onerror=function(){if(a.attr("data-src",""),"error"in e){var i=Array.prototype.slice.call(arguments,0);i=[a,e].concat(i),e.error.apply(t.jail,i)}},r.src=a.attr("data-src")}function c(i,a,n){for(var r=i.parent(),l=!0;r.length&&"BODY"!==r.get(0).nodeName.toUpperCase();){if("hidden"===r.css("overflow")){if(!o(r,i,n.offset)){l=!1;break}}else if("scroll"===r.css("overflow")&&!o(r,i,n.offset)){l=!1,t(d).data("triggerElem",r),n.event="scroll",e(n,t(d));break}if("hidden"===r.css("visibility")||"hidden"===i.css("visibility")){l=!1;break}if(a!==s&&r===a)break;r=r.parent()}return l}var s=t(window),f={id:"jail",timeout:1,effect:!1,speed:400,triggerElement:null,offset:0,event:"load",callback:null,callbackAfterEachImage:null,placeholder:!1,loadHiddenImages:!1},d=[],u=!1;return t.jail=function(e,i){var a=e||{},n=t.extend({},f,i);t.jail.prototype.init(a,n),/^(load|scroll)/.test(n.event)?t.jail.prototype.later.call(a,n):t.jail.prototype.onEvent.call(a,n)},t.jail.prototype.init=function(e,i){e.data("triggerElem",i.triggerElement?t(i.triggerElement):s),!i.placeholder||e.each(function(){t(this).attr("src",i.placeholder)})},t.jail.prototype.onEvent=function(i){var a=this;i.triggerElement?e(i,a):a.on(i.event+"."+i.id,{options:i,images:a},function(e){var i=t(this),a=e.data.options,n=e.data.images;d=t.extend({},n),l(a,i),t(e.currentTarget).unbind(e.type+"."+a.id)})},t.jail.prototype.later=function(i){var a=this;setTimeout(function(){d=t.extend({},a),a.each(function(){r(i,this,a)}),i.event="scroll",e(i,a)},i.timeout)},t.fn.jail=function(e){return new t.jail(this,e),d=[],this},t.jail});